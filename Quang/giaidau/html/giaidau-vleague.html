<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giải đấu V.league 1</title>
    <link rel="stylesheet" href="../../../css/header.css">
    <link rel="stylesheet" href="../css/hotnew.css">
    <link rel="stylesheet" href="../css/tinduoi.css">
    <link rel="stylesheet" href="../../../css/footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/general.css">
    <script src="../../../Js/Search-header.js"></script>
</head>

<body>
    <!--header and search-header section-->
    <!--header section-->
    <header class="navbar">
        <div class="logo">
            <a href="../../../index.html">
                <img src="../image/header-footer-logo/logo-web.png" alt="Ảnh tên web">
            </a>
        </div>
        <nav class="menu">
            <ul>
                <li><a href="../../../index.html">Trang chủ</a></li>
                <li class="dropdown">
                    <a href="#">Giải đấu <i class="fas fa-chevron-down dropdown-icon"></i></a>
                    <ul class="dropdown-menu">
                        <li><a href="../../giaidau/html/giaidau-EPL.html">Premier League</a></li>
                        <li><a href="../../giaidau/html/giaidau-LaLiga.html">La Liga</a></li>
                        <li><a href="../../giaidau/html/giaidau-seria.html">Serie A</a></li>
                        <li><a href="../../giaidau/html/giaidau-bundes.html">Bundesliga</a></li>
                        <li><a href="../../giaidau/html/giaidau-l1.html">Ligue 1</a></li>
                        <li><a href="../../giaidau/html/giaidau-vleague.html">V.League 1</a></li>
                    </ul>
                </li>
                <li><a href="../../giaidau/html/bongdaVN.html">Bóng đá Việt Nam</a></li>
                <li><a href="../../giaidau/html/bongdaTG.html">Bóng đá thế giới</a></li>
            </ul>
        </nav>
        <div class="nav-icons">
            <a class="search-button">
                <img src="../image/header-footer-logo/logo-search.png" alt="Search Icon">
            </a>
            <a class="account-button" href="#">
                <img src="../image/header-footer-logo/avatar.png" alt="User Icon">
            </a>
        </div>
    </header>

    <!--search-header section-->
    <div class="navbar search-header">
        <div class="logo">
            <a href="/index.html">
                <img src="../image/header-footer-logo/logo-web.png" alt="Ảnh tên web">
            </a>
        </div>
        
        <form class="search-bar">
            <input type="text" id="search-text" placeholder="Nhập nội dung tìm kiếm...">
            <button><img src="../image/header-footer-logo/logo-search.png" alt="Search Icon"></button>
            <div id="dropdown-searchbar" class="dropdown-searchbar"></div>
        </form>

        <div class="nav-icons">
            <a class="search-button">
                <img src="../image/header-footer-logo/logo-search.png" alt="Search Icon">
            </a>
            <a class="account-button" href="#">
                <img src="../image/header-footer-logo/avatar.png" alt="User Icon">
            </a>
        </div>
    </div>
    <div class="dark-overlay"></div>

    <!-- phần giải đấu -->
    <div class="container">
        <div class="header-container">
            <div class="breadcrumb">Giải đấu <i class="fa-solid fa-angle-right"></i> V League</div>
            <img src="../image/content-img/vleague.png" alt="laliga">
        </div>
        <!-- Tin trên -->
        <!--Hotnews section-->
        <div class="Hotnews">
            <!--Hotnews-general-->
            <div class="Hotnews-general">
                <div class="hotnews-titlebox">
                    <img class="hotnews-logo" src="../image/logo-tinnoibat.png" alt="logo-tinnoibat">
                    <p class="hotnews-title">Tin nổi bật <i class="fa-solid fa-angle-right"></i></p>
                </div>
                <div class="news-container">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <div class="main-news">
                            <img src="../image/content-img/Tuyển Việt Nam lần đầu tái ngộ sau khi vô địch ASEAN Cup.png"
                                alt="Main News">
                            <div class="main-overlay"></div>
                            <div class="news-info">
                                <span class="category">V League</span>
                                <h3>Tuyển Việt Nam lần đầu tái ngộ sau khi vô địch ASEAN Cup</h3>
                                <p>Tác giả - 9 giờ trước</p>
                            </div>
                        </div>
                    </a>
                    <div class="side-news">
                        <div class="news-item-top">
                            <a href="../../baichitiet/html/baichitiet.html">
                                <img src="../image/content-img/Đội của Hoàng Đức, Văn Lâm lập kỷ lục toàn thắng lượt đi hạng Nhất.png"
                                    alt="">
                                <div class="news-text">
                                    <span class="category">V League</span>
                                    <p>Đội của Hoàng Đức, Văn Lâm lập kỷ lục toàn thắng lượt đi hạng Nhất</p>
                                    <small>Tác giả - 9 giờ trước</small>
                                </div>
                            </a>
                        </div>
                        <div class="news-item-top">
                            <a href="../../baichitiet/html/baichitiet.html">
                                <img src="../image/content-img/HLV Nguyễn Anh Đức khóc khi chia tay CLB Bình Phước.png"
                                    alt="">
                                <div class="news-text">
                                    <span class="category">V League</span>
                                    <p>HLV Nguyễn Anh Đức khóc khi chia tay CLB Bình Phước</p>
                                    <small>Tác giả - 9 giờ trước</small>
                                </div>
                            </a>
                        </div>
                        <div class="news-item-top">
                            <a href="../../baichitiet/html/baichitiet.html">
                                <img src="../image/content-img/Hoàng Đức, Tiến Linh tranh Quả Bóng Vàng Việt Nam 2024.png"
                                    alt="">
                                <div class="news-text">
                                    <span class="category">V League</span>
                                    <p>Hoàng Đức, Tiến Linh tranh Quả Bóng Vàng Việt Nam 2024</p>
                                    <small>Tác giả - 9 giờ trước</small>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
        </div>
        <!-- seperate line-->
        <!-- tin duoi -->
        <div class="news-bottom">
            <div class="news-list">
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Jason Quang Vinh Pendant tiếp tục lỡ hẹn đội tuyển Việt Nam.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>V League</h3>
                            <p>Jason Quang Vinh Pendant tiếp tục lỡ hẹn đội tuyển Việt Nam</p>

                            <small>Tác giả - 9 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Nguyễn Filip lỡ hẹn tuyển Việt Nam.png" alt="News Image">
                        <div class="news-content">
                            <h3>V League</h3>
                            <p>Nguyễn Filip lỡ hẹn tuyển Việt Nam</p>

                            <small>Tác giả - 8 giờ trước</small>
                        </div>
                    </a>
                </div>

                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Quả Bóng Vàng nữ Thùy Trang mơ dự World Cup lần hai.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>V League</h3>
                            <p>Quả Bóng Vàng nữ Thùy Trang mơ dự World Cup lần hai</p>

                            <small>Tác giả - 7 giờ trước</small>
                        </div>
                    </a>
                </div>

                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Quả Bóng Vàng Thùy Trang 'Tôi chưa hết thời'.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>V League</h3>
                            <p>Quả Bóng Vàng Thùy Trang: 'Tôi chưa hết thời'</p>

                            <small>Tác giả - 6 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Tiến Linh chưa muốn dừng lại sau Quả Bóng Vàng.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>V League</h3>
                            <p>Tiến Linh chưa muốn dừng lại sau Quả Bóng Vàng</p>

                            <small>Tác giả - 6 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Tuyển Việt Nam sắp có thêm trợ lý HLV từng dự World Cup.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>V League</h3>
                            <p>Tuyển Việt Nam sắp có thêm trợ lý HLV từng dự World Cup</p>

                            <small>Tác giả - 6 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/U22 Việt Nam gọi hai cầu thủ Việt kiều.png" alt="News Image">
                        <div class="news-content">
                            <h3>V League</h3>
                            <p>U22 Việt Nam gọi hai cầu thủ Việt kiều</p>

                            <small>Tác giả - 6 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Việt Nam bắt đầu kế hoạch tranh vé U17 World Cup.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>V League</h3>
                            <p>Việt Nam bắt đầu kế hoạch tranh vé U17 World Cup</p>

                            <small>Tác giả - 6 giờ trước</small>
                        </div>
                    </a>
                </div>
            </div>
            <!-- Bảng xếp hạng -->
            <div class="ranking">
                <table>
                    <thead>
                        <tr>
                            <th colspan="5">
                                <img src="../image/team-logo/bxh.png" alt="Bảng xếp hạng" class="ranking-img">
                            </th>
                        </tr>
                    </thead>
                    <tr class="chitieu" style="border: 1px solid #ccc ;">
                        <th>STT</th>
                        <th style="text-align: left;">
                            <div style="padding-left:10px ;">Đội bóng</div>
                        </th>
                        <th>Trận</th>
                        <th>Hiệu số</th>
                        <th>Điểm</th>
                    </tr>
                    <tr class="boc">
                        <td>01</td>
                        <td class="team-logo"><img src="../image/team-logo/nam_dinh.png" alt="">Nam Định</td>
                        <td>16</td>
                        <td>+15</td>
                        <td>33</td>
                    </tr>
                    <tr class="boc">
                        <td>02</td>
                        <td class="team-logo"><img src="../image/team-logo/thanh_hoa.png" alt="">Đông Á Thanh Hóa</td>
                        <td>16</td>
                        <td>+12</td>
                        <td>30</td>
                    </tr>
                    <tr class="boc">
                        <td>03</td>
                        <td class="team-logo"><img src="../image/team-logo/ha_noi.png" alt="">Hà Nội FC</td>
                        <td>16</td>
                        <td>+10</td>
                        <td>28</td>
                    </tr>
                    <tr class="boc">
                        <td>04</td>
                        <td class="team-logo"><img src="../image/team-logo/becamex_binh_duong.png" alt="">Becamex Bình
                            Dương</td>
                        <td>16</td>
                        <td>+8</td>
                        <td>27</td>
                    </tr>
                    <tr class="boc">
                        <td>05</td>
                        <td class="team-logo"><img src="../image/team-logo/viettel.png" alt="">Viettel FC</td>
                        <td>16</td>
                        <td>+6</td>
                        <td>25</td>
                    </tr>
                    <tr class="boc">
                        <td>06</td>
                        <td class="team-logo"><img src="../image/team-logo/cong_an_ha_noi.png" alt="">Công An Hà Nội
                        </td>
                        <td>16</td>
                        <td>+5</td>
                        <td>24</td>
                    </tr>
                    <tr class="boc">
                        <td>07</td>
                        <td class="team-logo"><img src="../image/team-logo/hoang_anh_gia_lai.png" alt="">Hoàng Anh Gia
                            Lai</td>
                        <td>16</td>
                        <td>+3</td>
                        <td>22</td>
                    </tr>
                    <tr class="boc">
                        <td>08</td>
                        <td class="team-logo"><img src="../image/team-logo/hai_phong.png" alt="">Hải Phòng</td>
                        <td>16</td>
                        <td>+1</td>
                        <td>21</td>
                    </tr>
                    <tr class="boc">
                        <td>09</td>
                        <td class="team-logo"><img src="../image/team-logo/quang_nam.png" alt="">Quảng Nam</td>
                        <td>16</td>
                        <td>-2</td>
                        <td>20</td>
                    </tr>
                    <tr class="boc">
                        <td>10</td>
                        <td class="team-logo"><img src="../image/team-logo/tp_ho_chi_minh.png" alt="">TP Hồ Chí Minh
                        </td>
                        <td>16</td>
                        <td>-4</td>
                        <td>19</td>
                    </tr>
                    <tr class="boc">
                        <td>11</td>
                        <td class="team-logo"><img src="../image/team-logo/song_lam_nghe_an.png" alt="">Sông Lam Nghệ An
                        </td>
                        <td>16</td>
                        <td>-6</td>
                        <td>17</td>
                    </tr>
                    <tr class="boc">
                        <td>12</td>
                        <td class="team-logo"><img src="../image/team-logo/binh_dinh.png" alt="">Bình Định</td>
                        <td>16</td>
                        <td>-8</td>
                        <td>16</td>
                    </tr>
                    <tr class="boc">
                        <td>13</td>
                        <td class="team-logo"><img src="../image/team-logo/da_nang.png" alt="">SHB Đà Nẵng</td>
                        <td>16</td>
                        <td>-10</td>
                        <td>14</td>
                    </tr>
                    <tr class="boc">
                        <td>14</td>
                        <td class="team-logo"><img src="../image/team-logo/hong_linh_ha_tinh.png" alt="">Hồng Lĩnh Hà
                            Tĩnh</td>
                        <td>16</td>
                        <td>-12</td>
                        <td>12</td>
                    </tr>
                </table>
            </div>
        </div>
        <br>
        <!-- số trang -->
        <div class="pagination">
            <button id="prev"><i class="fa-solid fa-angle-left"></i></button>
            <span id="page-number">01</span>
            <button id="next"><i class="fa-solid fa-angle-right"></i></button>
        </div>
        <!--tăng độ dài trang xem nút thôi không cần xóa đi 2 thẻ <br>-->
        <br>
        <br>

        <!--Footer-->
        <footer>
            <div class="footer-1st">
                <img class="logo" src="../image/header-footer-logo/logo-web.png" alt="logo website">
                <p class="description">Trang thông tin điện tử tổng hợp về lĩnh vực bóng đá trong nước và thế giới
                </p>
                <i class="fa-brands fa-square-facebook"></i>
                <i class="fa-brands fa-youtube"></i>
            </div>

            <div class="sep-line"></div>

            <div class="footer-2nd">
                <div class="contact">
                    <div class="contact-item">
                        <p class="ct-info">Số điện thoại liên hệ</p>
                        <p class="ct-value">0902170359</p>
                    </div>
                    <div class="contact-item">
                        <p class="ct-info">Email</p>
                        <p class="ct-value">xinmotlanthua.lumkeo@gmail.com</p>
                    </div>
                    <div class="contact-item">
                        <p class="ct-info">Địa chỉ</p>
                        <p class="ct-value">68 - ngõ 203 Kim Ngưu, Hai Bà Trưng, Hà Nội</p>
                    </div>
                    <div class="contact-item boxing">
                        <p class="copyright">Copyright@2025 - BTL thiet ke website LumKeo.bet</p>
                    </div>
                </div>

                <div class="message">
                    <p class="ms-title pacifico-regular">Trang web này chắc chắn không thể hoạt động nếu thiếu đi sự
                        đồng
                        hành của quý độc giả!</p>
                    <div class="ms-donate">
                        <p class="ms-detail pacifico-regular">Trong tương lai, LumKeo.bet sẽ mở rộng thêm các tính
                            năng
                            mới
                            như livescore, dự đoán tỉ số, soi kèo,... cho tới lúc đó, mọi sự ủng hộ của mina đều là
                            động
                            lực
                            lớn lao cho anh em chúng tôi vững bước. Cảm ơn mina rấc nhìuuu!</p>
                        <img src="../image/header-footer-logo/logo-footer.png" alt="creator-avatar">
                        <img src="../image/header-footer-logo/qr-code.png" alt="creator's QR">
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <script>
        // Helper: Get cookie
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        // Helper: Decode JWT
        function decodeJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error('Error decoding JWT:', error);
                return null;
            }
        }
        
        // Fetch current user data
        async function getCurrentUser() {
            try {
                const token = getCookie("token");
                console.log('Token:', token);
                if (!token) {
                    throw new Error("Không tìm thấy token, vui lòng đăng nhập!");
                }

                const payload = decodeJwt(token);
                if (!payload) {
                    throw new Error("Token không hợp lệ!");
                }

                const { id, username, role, avatar } = payload;
                console.log('User ID:', id);
                console.log('User Name:', username);
                console.log('User Role:', role);
                console.log('Full Payload:', payload);

                if (!id || !/^[0-9a-fA-F]{24}$/.test(id)) {
                    throw new Error("ID không hợp lệ, phải là ObjectId MongoDB!");
                }

                let userData = { id, username, role, avatar };
                try {
                    const res = await fetch(`http://localhost:3000/api/users/${id}?_t=${Date.now()}`, {
                        headers: {
                            'Accept': 'application/json',
                            'Authorization': `Bearer ${token.trim()}`
                        }
                    });

                    if (!res.ok) {
                        const errorText = await res.text();
                        console.warn('API Error:', errorText);
                        if (res.status === 401) {
                            const errorData = JSON.parse(errorText);
                            if (errorData.error === "jwt expired") {
                                // Token expired, log out and redirect to login
                                deleteCookie("token");
                                window.location.href = '../../Hi-Tech/Login.html';
                                return null; // Exit function to prevent further execution
                            }
                        } else if (res.status === 403) {
                            console.warn('Permission denied, using token data');
                            return userData;
                        } else {
                            throw new Error(`HTTP error! Status: ${res.status} - ${errorText}`);
                        }
                    }

                    const contentType = res.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        throw new Error('Response is not JSON');
                    }

                    const data = await res.json();
                    const user = data.user || data;
                    userData = {
                        id,
                        username: user.username !== undefined ? user.username : username,
                        role: user.role !== undefined ? user.role : role,
                        avatar: user.avatar !== undefined ? user.avatar : avatar
                    };
                } catch (apiError) {
                    console.warn('API request failed, falling back to token data:', apiError);
                    return userData;
                }

                return userData;
            } catch (error) {
                console.error('getCurrentUser Error:', error);
                throw error;
            }
        }
        
        // Update account buttons in both main navbar and search-header
        document.addEventListener('DOMContentLoaded', async () => {
            const accountButtons = document.querySelectorAll('.account-button');
        
            try {
                const user = await getCurrentUser();
                if (!user) return; // Exit if user is null (due to logout redirect)

                console.log('Logged-in user:', user);
        
                // Determine redirect URL based on role using correct relative paths from Quang/baichitiet/
                let redirectUrl;
                switch (user.role) {
                    case 'admin':
                        redirectUrl = '../../../Thuy + DucMinh/ADMIN_QLBB.html';
                        break;
                    case 'author':
                        redirectUrl = '../../../Thuy + DucMinh/AUTHOR_QLBV.html';
                        break;
                    case 'user':
                        redirectUrl = '../../../Thuy + DucMinh/USER_BBDL.html';
                        break;
                    default:
                        alert('Không xác định được quyền truy cập: ' + user.role);
                        redirectUrl = '../../../Hi-Tech/Login.html'; // Fallback to login with relative path
                }
        
                // Update all account buttons to redirect to the appropriate page
                accountButtons.forEach(button => {
                    button.href = redirectUrl;
                    button.addEventListener('click', () => {
                        localStorage.setItem('userInfo', JSON.stringify(user));
                    });
                });
            } catch (error) {
                console.error('User not logged in or error:', error.message);
                // User is not logged in or an error occurred, redirect to login page
                accountButtons.forEach(button => {
                    button.href = '../../../Hi-Tech/Login.html';
                });
            }
        });
        </script>
</body>

</html>