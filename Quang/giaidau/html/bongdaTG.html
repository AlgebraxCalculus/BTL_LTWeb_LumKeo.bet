<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bóng đá Thế giới</title>
    <link rel="stylesheet" href="../../../css/header.css">
    <link rel="stylesheet" href="../css/hotnew.css">
    <link rel="stylesheet" href="../css/tinduoi.css">
    <link rel="stylesheet" href="../../../css/footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/general.css">
    <link rel="stylesheet" href="../css/tincanh.css">
    <script src="/Js/Search-header.js"></script>

</head>

<body>
    <!--header and search-header section-->
    <!--header section-->
    <header class="navbar">
        <div class="logo">
            <a href="../../../index.html">
                <img src="../image/header-footer-logo/logo-web.png" alt="Ảnh tên web">
            </a>
        </div>
        <nav class="menu">
            <ul>
                <li><a href="../../../index.html">Trang chủ</a></li>
                <li class="dropdown">
                    <a href="#">Giải đấu <i class="fas fa-chevron-down dropdown-icon"></i></a>
                    <ul class="dropdown-menu">
                        <li><a href="../../giaidau/html/giaidau-EPL.html">Premier League</a></li>
                        <li><a href="../../giaidau/html/giaidau-LaLiga.html">La Liga</a></li>
                        <li><a href="../../giaidau/html/giaidau-seria.html">Serie A</a></li>
                        <li><a href="../../giaidau/html/giaidau-bundes.html">Bundesliga</a></li>
                        <li><a href="../../giaidau/html/giaidau-l1.html">Ligue 1</a></li>
                        <li><a href="../../giaidau/html/giaidau-vleague.html">V.League 1</a></li>
                    </ul>
                </li>
                <li><a href="../../giaidau/html/bongdaVN.html">Bóng đá Việt Nam</a></li>
                <li><a href="../../giaidau/html/bongdaTG.html">Bóng đá thế giới</a></li>
            </ul>
        </nav>
        <div class="nav-icons">
            <a class="search-button">
                <img src="../image/header-footer-logo/logo-search.png" alt="Search Icon">
            </a>
            <a class="account-button" href="#">
                <img src="../image/header-footer-logo/avatar.png" alt="User Icon">
            </a>
        </div>
    </header>

    <!--search-header section-->
    <div class="navbar search-header">
        <div class="logo">
            <a href="/index.html">
                <img src="../image/header-footer-logo/logo-web.png" alt="Ảnh tên web">
            </a>
        </div>
        
        <form class="search-bar">
            <input type="text" id="search-text" placeholder="Nhập nội dung tìm kiếm...">
            <button><img src="../image/header-footer-logo/logo-search.png" alt="Search Icon"></button>
            <div id="dropdown-searchbar" class="dropdown-searchbar"></div>
        </form>

        <div class="nav-icons">
            <a class="search-button">
                <img src="../image/header-footer-logo/logo-search.png" alt="Search Icon">
            </a>
            <a class="account-button" href="#">
                <img src="../image/header-footer-logo/avatar.png" alt="User Icon">
            </a>
        </div>
    </div>
    <div class="dark-overlay"></div>

    <!-- phần giải đấu -->
    <div class="container">
        <div class="header-container">
            <div class="breadcrumb">Bóng đá Thế giới</div>
            <img src="../image/content-img/bongdaTG.jpg.png" alt="laliga">
        </div>
        <!-- Tin trên -->
        <!--Hotnews section-->
        <div class="Hotnews">
            <!--Hotnews-general-->
            <div class="Hotnews-general">
                <div class="hotnews-titlebox">
                    <img class="hotnews-logo" src="../image/logo-tinnoibat.png" alt="logo-tinnoibat">
                    <p class="hotnews-title">Tin nổi bật <i class="fa-solid fa-angle-right"></i></p>
                </div>
                <div class="news-container">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <div class="main-news">
                            <img src="../image/content-img/tinnoibat1.png" alt="Main News">
                            <div class="main-overlay"></div>
                            <div class="news-info">
                                <span class="category">Premier League</span>
                                <h3>Man United bất ngờ dẫn đầu Ngoại hạng Anh, Ruben Amorim tìm ra công thức chiến thắng
                                </h3>
                                <p>Tác giả - 9 giờ trước</p>
                            </div>
                        </div>
                    </a>
                    <div class="side-news">
                        <div class="news-item-top">
                            <a href="../../baichitiet/html/baichitiet.html">
                                <img src="../image/content-img/Bayern thua trận đầu tại Bundesliga.png" alt="">
                                <div class="news-text">
                                    <span class="category">Bundesliga</span>
                                    <p>Bayern thua trận đầu tại Bundesliga</p>
                                    <small>Tác giả - 9 giờ trước</small>
                                </div>
                            </a>
                        </div>
                        <div class="news-item-top">
                            <a href="../../baichitiet/html/baichitiet.html">
                                <img src="../image/content-img/Dembele lập hai hattrick liên tiếp cho PSG.png" alt="">
                                <div class="news-text">
                                    <span class="category">Ligue 1</span>
                                    <p>Dembele lập hai hattrick liên tiếp cho PSG</p>
                                    <small>Tác giả - 9 giờ trước</small>
                                </div>
                            </a>
                        </div>
                        <div class="news-item-top">
                            <a href="../../baichitiet/html/baichitiet.html">
                                <img src="../image/content-img/Antony được xóa thẻ đỏ, sẵn sàng đấu Real.png" alt="">
                                <div class="news-text">
                                    <span class="category">La Liga</span>
                                    <p>Antony được xóa thẻ đỏ, sẵn sàng đấu Real</p>
                                    <small>Tác giả - 9 giờ trước</small>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="line"></div>
        </div>
        <!-- tin duoi -->
        <div class="news-bottom">
            <div class="news-list1">
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Kane giúp Bayern vững đỉnh bảng Bundesliga.png" alt="News Image">
                        <div class="news-content">
                            <h3>Bundesliga</h3>
                            <p>Kane giúp Bayern vững đỉnh bảng Bundesliga</p>
                            <small>Tác giả - 9 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/item2.png" alt="News Image">
                        <div class="news-content">
                            <h3>Premier League</h3>
                            <p>Phút xuất thần của thủ môn Arsenal</p>

                            <small>Tác giả - 8 giờ trước</small>
                        </div>
                    </a>
                </div>

                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/PSG chạm mốc đặc biệt của Ligue 1 sau 18 năm.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>Ligue 1</h3>
                            <p>PSG chạm mốc đặc biệt của Ligue 1 sau 18 năm</p>

                            <small>Tác giả - 8 giờ trước</small>
                        </div>
                    </a>
                </div>

                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Barca đòi lại đỉnh bảng La Liga với trận thắng đậm.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>La Liga</h3>
                            <p>Barca đòi lại đỉnh bảng La Liga với trận thắng đậm</p>

                            <small>Tác giả - 9 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/HLV và đội trưởng Milan suýt ẩu đả trên sân.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>Serie A</h3>
                            <p>HLV và đội trưởng Milan suýt ẩu đả trên sân</p>

                            <small>Tác giả - 9 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Inter 'đốt nóng' cuộc đua vô địch Serie A.png" alt="News Image">
                        <div class="news-content">
                            <h3>Serie A</h3>
                            <p>Inter 'đốt nóng' cuộc đua vô địch Serie A</p>

                            <small>Tác giả - 8 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/item4.png" alt="News Image">
                        <div class="news-content">
                            <h3>Premier League</h3>
                            <p>Món hời chuyển nhượng cho MU</p>

                            <small>Tác giả - 6 giờ trước</small>
                        </div>
                    </a>
                </div>
                <div class="news-item">
                    <a href="../../baichitiet/html/baichitiet.html">
                        <img src="../image/content-img/Simeone-Trận hòa Barca 4-4 khiến tôi say mê.png"
                            alt="News Image">
                        <div class="news-content">
                            <h3>La Liga</h3>
                            <p>Simeone:'Trận hòa Barca 4-4 khiến tôi say mê'</p>

                            <small>Tác giả - 6 giờ trước</small>
                        </div>
                    </a>
                </div>
            </div>
            <!-- tincanh -->
            <div class="tincanh">
                <div class="tincanh-phanloai">
                    <h1>Tin khác</h1>
                    <hr>
                </div>
                <a href="../../baichitiet/html/baichitiet.html" class="tincanh-hieuung">
                    <div class="tincanh-content">
                        <img src="../image/content-img/HLV bị cấm 9 tháng vì gây hấn trọng tài ở Ligue 1.png" alt="">
                        <div class="tincanh-vanban">
                            <h3>Ligue 1</h3>
                            <p>HLV bị cấm 9 tháng vì gây hấn trọng tài ở Ligue 1</p>
                            <small>Tác giả - 9 tiếng trước</small>
                        </div>
                    </div>
                </a>
                <a href="../../baichitiet/html/baichitiet.html" class="tincanh-hieuung">
                    <div class="tincanh-content">
                        <img src="../image/content-img/Alvarez đưa Atletico lên đỉnh bảng La Liga.png" alt="">
                        <div class="tincanh-vanban">
                            <h3>La Liga</h3>
                            <p>Alvarez đưa Atletico lên đỉnh bảng La Liga</p>
                            <small>Tác giả - 9 tiếng trước</small>
                        </div>
                    </div>
                </a>
                <a href="../../baichitiet/html/baichitiet.html" class="tincanh-hieuung">
                    <div class="tincanh-content">
                        <img src="../image/content-img/Bayern thắng hoành tráng trước kỳ nghỉ giữa mùa Bundesliga.png" alt="">
                        <div class="tincanh-vanban">
                            <h3>Bundesliga</h3>
                            <p>Bayern thắng hoành tráng tại Bundesliga</p>
                            <small>Tác giả - 9 tiếng trước</small>
                        </div>
                    </div>
                </a>
                <br>

                <div class="tincanh-phanloai">
                    <h1>Có thể bạn quan tâm</h1>
                    <hr>
                </div>

                <a href="../../baichitiet/html/baichitiet.html" class="tincanh-hieuung">
                    <div class="tincanh-content">
                        <img src="../image/content-img/Antony được xóa thẻ đỏ, sẵn sàng đấu Real.png" alt="">
                        <div class="tincanh-vanban">
                            <h3>La Liga</h3>
                            <p>Antony được xóa thẻ đỏ, sẵn sàng đấu Real</p>
                            <small>Tác giả - 9 tiếng trước</small>
                        </div>
                    </div>
                </a>
                <a href="../../baichitiet/html/baichitiet.html" class="tincanh-hieuung">
                    <div class="tincanh-content">
                        <img src="../image/content-img/Fabregas - người thổi làn gió mới vào Serie A.png" alt="">
                        <div class="tincanh-vanban">
                            <h3>Serie A</h3>
                            <p>Fabregas - người thổi làn gió mới vào Serie A</p>
                            <small>Tác giả - 9 tiếng trước</small>
                        </div>
                    </div>
                </a>
                <a href="../../baichitiet/html/baichitiet.html" class="tincanh-hieuung">
                    <div class="tincanh-content">
                        <img src="../image/content-img/Real có thể phải trả giá vì thua Betis.png" alt="">
                        <div class="tincanh-vanban">
                            <h3>La Liga</h3>
                            <p>Real có thể phải trả giá vì thua Betis</p>
                            <small>Tác giả - 9 tiếng trước</small>
                        </div>
                    </div>
                </a>
                
            </div>
        </div>
        <br>
        <!-- số trang -->
        <div class="pagination">
            <button id="prev"><i class="fa-solid fa-angle-left"></i></button>
            <span id="page-number">01</span>
            <button id="next"><i class="fa-solid fa-angle-right"></i></button>
        </div>
        <!--tăng độ dài trang xem nút thôi không cần xóa đi 2 thẻ <br>-->
        <br>
        <br>

        <!--Footer-->
        <footer>
            <div class="footer-1st">
                <img class="logo" src="../image/header-footer-logo/logo-web.png" alt="logo website">
                <p class="description">Trang thông tin điện tử tổng hợp về lĩnh vực bóng đá trong nước và thế giới
                </p>
                <i class="fa-brands fa-square-facebook"></i>
                <i class="fa-brands fa-youtube"></i>
            </div>

            <div class="sep-line"></div>

            <div class="footer-2nd">
                <div class="contact">
                    <div class="contact-item">
                        <p class="ct-info">Số điện thoại liên hệ</p>
                        <p class="ct-value">0902170359</p>
                    </div>
                    <div class="contact-item">
                        <p class="ct-info">Email</p>
                        <p class="ct-value">xinmotlanthua.lumkeo@gmail.com</p>
                    </div>
                    <div class="contact-item">
                        <p class="ct-info">Địa chỉ</p>
                        <p class="ct-value">68 - ngõ 203 Kim Ngưu, Hai Bà Trưng, Hà Nội</p>
                    </div>
                    <div class="contact-item boxing">
                        <p class="copyright">Copyright@2025 - BTL thiet ke website LumKeo.bet</p>
                    </div>
                </div>

                <div class="message">
                    <p class="ms-title pacifico-regular">Trang web này chắc chắn không thể hoạt động nếu thiếu đi sự
                        đồng
                        hành của quý độc giả!</p>
                    <div class="ms-donate">
                        <p class="ms-detail pacifico-regular">Trong tương lai, LumKeo.bet sẽ mở rộng thêm các tính
                            năng
                            mới
                            như livescore, dự đoán tỉ số, soi kèo,... cho tới lúc đó, mọi sự ủng hộ của mina đều là
                            động
                            lực
                            lớn lao cho anh em chúng tôi vững bước. Cảm ơn mina rấc nhìuuu!</p>
                        <img src="../image/header-footer-logo/logo-footer.png" alt="creator-avatar">
                        <img src="../image/header-footer-logo/qr-code.png" alt="creator's QR">
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <script>
        // Helper: Get cookie
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        // Helper: Decode JWT
        function decodeJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error('Error decoding JWT:', error);
                return null;
            }
        }
        
        // Fetch current user data
        async function getCurrentUser() {
            try {
                const token = getCookie("token");
                console.log('Token:', token);
                if (!token) {
                    throw new Error("Không tìm thấy token, vui lòng đăng nhập!");
                }
        
                const payload = decodeJwt(token);
                if (!payload) {
                    throw new Error("Token không hợp lệ!");
                }
        
                const { id, username, role, avatar } = payload;
                console.log('User ID:', id);
                console.log('User Name:', username);
                console.log('User Role:', role);
                console.log('Full Payload:', payload);
        
                if (!id || !/^[0-9a-fA-F]{24}$/.test(id)) {
                    throw new Error("ID không hợp lệ, phải là ObjectId MongoDB!");
                }
        
                let userData = { id, username, role, avatar };
                try {
                    const res = await fetch(`http://localhost:3000/api/users/${id}?_t=${Date.now()}`, {
                        headers: {
                            'Accept': 'application/json',
                            'Authorization': `Bearer ${token.trim()}`
                        }
                    });
        
                    if (!res.ok) {
                        const errorText = await res.text();
                        console.warn('API Error:', errorText);
                        if (res.status === 403) {
                            console.warn('Permission denied for /api/users/:id, using token data');
                            return userData;
                        } else {
                            throw new Error(`HTTP error! Status: ${res.status} - ${errorText}`);
                        }
                    }
        
                    const contentType = res.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        throw new Error('Response is not JSON');
                    }
        
                    const data = await res.json();
                    const user = data.user || data;
                    userData = {
                        id,
                        username: user.username !== undefined ? user.username : username,
                        role: user.role !== undefined ? user.role : role,
                        avatar: user.avatar !== undefined ? user.avatar : avatar
                    };
                } catch (apiError) {
                    console.warn('Falling back to token data due to API error:', apiError);
                    return userData;
                }
        
                return userData;
            } catch (error) {
                console.error('getCurrentUser Error:', error);
                throw error;
            }
        }
        
        // Update account buttons in both main navbar and search-header
        document.addEventListener('DOMContentLoaded', async () => {
            const accountButtons = document.querySelectorAll('.account-button');
        
            try {
                const user = await getCurrentUser();
                console.log('Logged-in user:', user);
        
                // Determine redirect URL based on role using correct relative paths from Quang/baichitiet/
                let redirectUrl;
                switch (user.role) {
                    case 'admin':
                        redirectUrl = '../../../Thuy + DucMinh/ADMIN_QLBB.html';
                        break;
                    case 'author':
                        redirectUrl = '../../../Thuy + DucMinh/AUTHOR_QLBV.html';
                        break;
                    case 'user':
                        redirectUrl = '../../../Thuy + DucMinh/USER_BBDL.html';
                        break;
                    default:
                        alert('Không xác định được quyền truy cập: ' + user.role);
                        redirectUrl = '../../../Hi-Tech/Login.html'; // Fallback to login with relative path
                }
        
                // Update all account buttons to redirect to the appropriate page
                accountButtons.forEach(button => {
                    button.href = redirectUrl;
                    button.addEventListener('click', () => {
                        localStorage.setItem('userInfo', JSON.stringify(user));
                    });
                });
            } catch (error) {
                console.error('User not logged in or error:', error.message);
                // User is not logged in or an error occurred, redirect to login page
                accountButtons.forEach(button => {
                    button.href = '../../../Hi-Tech/Login.html';
                });
            }
        });
        </script>
</body>

</html>